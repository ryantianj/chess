!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var l=function(t,l){if("object"!==e(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,l||"default");if("object"!==e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===l?String:Number)(t)}(t,"string");return"symbol"===e(l)?l:String(l)}function l(e,l){for(var o=0;o<l.length;o++){var n=l[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,t(n.key),n)}}function o(e,t,o){return t&&l(e.prototype,t),o&&l(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function c(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function a(t){var l=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=i(t);if(l){var r=i(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return function(t,l){if(l&&("object"===e(l)||"function"===typeof l))return l;if(void 0!==l)throw new TypeError("Derived constructors may only return object or undefined");return s(t)}(this,o)}}var w=o((function e(t,l){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];n(this,e),this.isAlive=!0,this.colour=t,this.cell=l,this.moves=o}));w.WHITE=-1,w.BLACK=1;var u=w,h=o((function e(t,l){n(this,e),this.row=t,this.col=l}));function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,o=new Array(t);l<t;l++)o[l]=e[l];return o}function d(e,t){var l="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!l){if(Array.isArray(e)||(l=function(e,t){if(e){if("string"===typeof e)return f(e,t);var l=Object.prototype.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?f(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){l&&(e=l);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,c=!1;return{s:function(){l=l.call(e)},n:function(){var e=l.next();return r=e.done,e},e:function(e){c=!0,s=e},f:function(){try{r||null==l.return||l.return()}finally{if(c)throw s}}}}function C(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var p=0;function g(e){return"__private_"+p+++"_"+e}var v=g("directions"),A=function(e){c(l,e);var t=a(l);function l(e,o,r){var c;return n(this,l),c=t.call(this,e,o,r),Object.defineProperty(s(c),v,{writable:!0,value:[[1,1],[-1,-1],[1,-1],[-1,1],[0,1],[1,0],[0,-1],[-1,0]]}),c.points=9,c.getMoves=function(e){var t,l=[],o=d(C(s(c),v)[v]);try{for(o.s();!(t=o.n()).done;)for(var n=t.value,r=c.cell.row,i=c.cell.col,a=n[0],w=n[1],u=a+r,f=w+i;e.canMove(u,f)||e.canEat(u,f,c.colour);){var p=new E(c.cell,new h(u,f),s(c));if(e.willCheck(s(c),p)||l.push(p),e.canEat(u,f,c.colour))break;u+=a,f+=w}}catch(g){o.e(g)}finally{o.f()}return l},c.getAttack=function(e){var t,l=[],o=d(C(s(c),v)[v]);try{for(o.s();!(t=o.n()).done;)for(var n=t.value,r=c.cell.row,i=c.cell.col,a=n[0],w=n[1],u=a+r,f=w+i;(e.canMove(u,f)||e.canEatDefend(u,f))&&(l.push(new E(c.cell,new h(u,f),s(c))),!e.canEatDefend(u,f));)u+=a,f+=w}catch(p){o.e(p)}finally{o.f()}return l},c.movePiece=function(e,t){var l=t.getBoard(),o=e.newCell.row,n=e.newCell.col,r=l[o][n];return null!==r&&(e.ate=r),l[o][n]=s(c),l[e.oldCell.row][e.oldCell.col]=null,c.cell=new h(o,n),c.moves.push(e),{row:o,col:n}},c.getString=function(){return(c.colour===u.WHITE?"w":"b")+"q"},e===u.WHITE?c.image="data:image/png;base64,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":c.image="data:image/png;base64,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",c}return o(l)}(u),m=o((function e(t,l,o){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{isCastle:!1},c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];n(this,e),this.oldCell=t,this.newCell=l,this.piece=o,this.isEnPassant=s,this.castle=r,this.ate=c,this.isPromotion=i}));m.getMoveString=function(e){return{oldCellRow:e.oldCell.row,oldCellCol:e.oldCell.col,newCellRow:e.newCell.row,newCellCol:e.newCell.col,pieceString:e.piece.getString(),isEnPassant:e.isEnPassant,castle:!1===e.castle.isCastle?{isCastle:!1}:{isCastle:!0,rook:{pieceString:e.castle.rook.piece.getString(),oldCellRow:e.castle.rook.oldCell.row,oldCellCol:e.castle.rook.oldCell.col,newCellRow:e.castle.rook.newCell.row,newCellCol:e.castle.rook.newCell.col}},ate:null!==e.ate?e.ate.getString():null,isPromotion:e.isPromotion}},m.parseMove=function(e,t){var l=new m(new h(t.oldCellRow,t.oldCellCol),new h(t.newCellRow,t.newCellCol),e.board.getPiece(t.oldCellRow,t.oldCellCol),t.isEnPassant,{isCastle:!1},e.board.getPiece(t.newCellRow,t.newCellCol),t.isPromotion);if(t.isPromotion&&e.board.promotePiece(new A(e.board.getPiece(t.oldCellRow,t.oldCellCol).colour,e.board.getPiece(t.oldCellRow,t.oldCellCol).cell)),t.castle.isCastle){var o=t.castle.rook;l.castle.isCastle=!0,l.castle.rook=new m(new h(o.oldCellRow,o.oldCellCol),new h(o.newCellRow,o.newCellCol),e.board.getPiece(o.oldCellRow,o.oldCellCol))}return l};var E=m;let b=0,S=new Map,y=!1;self.addEventListener("message",(async e=>{S=new Map;const t=(e,t,l,o)=>{b++;const s=new i;s.setBoardString(e);const r=performance.now();s.moves=l.map((e=>w.parseMove(s,e))),y=s.isEndGame(),y&&(console.log("endgame"),s.setEndGame()),s.updatePieceValues(),console.log(s.board);const c=n(s,t,-Number.MAX_VALUE,Number.MAX_VALUE,!0,o,o,t),a=performance.now();return console.log(a-r,b),console.log("Score",c[1]),c[0]},l=(e,t)=>e.getScore(t),o=e=>e===u.BLACK?u.WHITE:u.BLACK,n=(e,t,s,i,a,w,u,h)=>{if(0===t){let t;if(w===u)t=c(s,i,e,u,2);else{const o=e.getBoardHash()+w.toString();S.has(o)?t=S.get(o):(t=l(e,w),S.set(o,t))}return[null,t]}const f=e.isGameOver(u);if(f.isGameOver&&u===w)return[null,-Number.MAX_VALUE];if(f.isGameOver&&u!==w)return[null,Number.MAX_VALUE];const d=f.allMoves;d.sort(r);const C=Math.floor(Math.random()*(d.length-1));let p=d.length>0?d[C]:null;if(a){let l=-Number.MAX_VALUE;for(const r of d){e.movePiece(r.piece,r);const c=n(e,t-1,s,i,!1,w,o(u),h)[1];if(e.undoMove(),c>l&&(l=c,p=r),i<=(s=Math.max(s,c)))break}return[p,l]}{let l=Number.MAX_VALUE;for(const r of d){e.movePiece(r.piece,r);const c=n(e,t-1,s,i,!0,w,o(u),h)[1];if(e.undoMove(),c<l&&(l=c,p=r),(i=Math.min(i,c))<=s)break}return[p,l]}},s=(e,t)=>{if(null!==e.ate&&null!==t.ate){return e.piece.points-e.ate.points<t.piece.points-t.ate.points?1:-1}return null!==e.ate?-1:null!==t.ate?1:0},r=(e,t)=>{if(null!==e.ate&&null!==t.ate){return e.piece.points-e.ate.points<t.piece.points-t.ate.points?-1:1}if(null!==e.ate)return-1;if(null!==t.ate)return 1;return(e.piece.colour===u.WHITE?e.piece.whiteScore[e.newCell.row][e.newCell.col]:e.piece.blackScore[e.newCell.row][e.newCell.col])<(t.piece.colour===u.WHITE?t.piece.whiteScore[t.newCell.row][t.newCell.col]:t.piece.blackScore[t.newCell.row][t.newCell.col])?1:-1},c=(e,t,n,r,i)=>{let a;const w=n.getBoardHash()+r.toString();if(S.has(w)?a=S.get(w):(a=l(n,r),S.set(w,a)),0===i)return a;if(a>=t)return t;e=Math.max(e,a);const u=n.getAllMoves(r);u.sort(s);for(const l of u)if(null!==l.ate&&l.ate.points<l.piece.points){n.movePiece(l.piece,l);let s=-c(-t,-e,n,o(r),i-1);if(n.undoMove(),s>=t)return t;s>e&&(e=s)}return e};class i{board;constructor(){this.board=this.newBoard(),this.moves=[]}newBoard=()=>[[new g(u.BLACK,new a(0,0)),new d(u.BLACK,new a(0,1)),new h(u.BLACK,new a(0,2)),new p(u.BLACK,new a(0,3)),new f(u.BLACK,new a(0,4)),new h(u.BLACK,new a(0,5)),new d(u.BLACK,new a(0,6)),new g(u.BLACK,new a(0,7))],[new C(u.BLACK,new a(1,0)),new C(u.BLACK,new a(1,1)),new C(u.BLACK,new a(1,2)),new C(u.BLACK,new a(1,3)),new C(u.BLACK,new a(1,4)),new C(u.BLACK,new a(1,5)),new C(u.BLACK,new a(1,6)),new C(u.BLACK,new a(1,7))],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[new C(u.WHITE,new a(6,0)),new C(u.WHITE,new a(6,1)),new C(u.WHITE,new a(6,2)),new C(u.WHITE,new a(6,3)),new C(u.WHITE,new a(6,4)),new C(u.WHITE,new a(6,5)),new C(u.WHITE,new a(6,6)),new C(u.WHITE,new a(6,7))],[new g(u.WHITE,new a(7,0)),new d(u.WHITE,new a(7,1)),new h(u.WHITE,new a(7,2)),new p(u.WHITE,new a(7,3)),new f(u.WHITE,new a(7,4)),new h(u.WHITE,new a(7,5)),new d(u.WHITE,new a(7,6)),new g(u.WHITE,new a(7,7))]];setEndGame=()=>{for(let e=0;e<8;e++)for(let t=0;t<8;t++){const l=this.getPiece(e,t);null!==l&&void 0!==l.whiteScoreEnd&&(l.colour===u.WHITE?l.whiteScore=l.whiteScoreEnd:l.blackScore=l.blackScoreEnd)}};updatePieceValues=()=>{let e=0,t=0;for(let l=0;l<8;l++)for(let o=0;o<8;o++){const n=this.getPiece(l,o);null!==n&&n instanceof C&&(n.colour===u.WHITE?e++:t++)}for(let l=0;l<8;l++)for(let o=0;o<8;o++){const n=this.getPiece(l,o);if(null!==n&&(n instanceof d&&(n.points-=3*(16-e-t)),n instanceof h&&(n.points+=3*(16-e-t)),n instanceof g&&(n.points+=3*(16-e-t)),n instanceof C)){let e=!0;if(o+1<8)for(let l=0;l<8;l++)this.getPiece(l,o+1)instanceof C&&(e=!1);if(o-1>=0)for(let l=0;l<8;l++)this.getPiece(l,o-1)instanceof C&&(e=!1);e&&(n.points+=30);let t=!1;for(let o=0;o<8;o++)n instanceof C&&o!==l&&(t=!0);t&&(n.points-=10)}}};isEndGame=()=>{let e=0,t=0,l=0,o=0;for(let n=0;n<8;n++)for(let s=0;s<8;s++){const r=this.getPiece(n,s);r instanceof p&&(r.colour===u.WHITE?l++:o++),(r instanceof g||r instanceof h||r instanceof d)&&(r.colour===u.WHITE?e++:t++)}return l<=1&&e<=0||o<=1&&t<=0||e<=2&&l<=0||t<=2&&o<=0};setBoardString=e=>{const t=[];for(let l=0;l<8;l++){const o=[];for(let t=0;t<8;t++){const n=e[l][t];if(null===n)o.push(null);else{const e="w"===n.slice(0,1)?u.WHITE:u.BLACK,s=n.slice(1,2);"b"===s?o.push(new h(e,new a(l,t))):"k"===s?o.push(new f(e,new a(l,t))):"n"===s?o.push(new d(e,new a(l,t))):"p"===s?o.push(new C(e,new a(l,t))):"q"===s?o.push(new p(e,new a(l,t))):"r"===s?o.push(new g(e,new a(l,t))):o.push(null)}}t.push(o)}this.board=t};getBoardHash=()=>{let e="";for(let t=0;t<8;t++)for(let l=0;l<8;l++)this.isEmpty(t,l)?e+=" ":e+=this.getPiece(t,l).getString();return e};clonePiece=e=>e instanceof C?new C(e.colour,new a(e.cell.row,e.cell.col)):e instanceof h?new h(e.colour,new a(e.cell.row,e.cell.col)):e instanceof f?new f(e.colour,new a(e.cell.row,e.cell.col)):e instanceof d?new d(e.colour,new a(e.cell.row,e.cell.col)):e instanceof p?new p(e.colour,new a(e.cell.row,e.cell.col)):e instanceof g?new g(e.colour,new a(e.cell.row,e.cell.col)):null;getBoard=()=>this.board;getPiece=(e,t)=>this.board[e][t];isEmpty=(e,t)=>!this.isOutSide(e,t)&&null===this.board[e][t];isUnderCheck=e=>!1;isOutSide=(e,t)=>e<0||t<0||e>7||t>7;canEat=(e,t,l)=>!this.isOutSide(e,t)&&!this.isEmpty(e,t)&&this.getPiece(e,t).colour!==l;canEatDefend=(e,t)=>!this.isOutSide(e,t)&&!this.isEmpty(e,t);canMove=(e,t)=>!this.isOutSide(e,t)&&this.isEmpty(e,t);canKingMove=(e,t,l)=>{const o=[[1,1],[-1,-1],[1,-1],[-1,1],[0,1],[1,0],[0,-1],[-1,0]];for(const n of o){const o=e+n[0],s=t+n[1];if(!this.isOutSide(o,s)&&!this.isEmpty(o,s)&&this.getPiece(o,s).name===u.KING&&this.getPiece(o,s).colour!==l)return!1}return!0};getAttackingSquares=e=>{const t=[];for(let l=0;l<8;l++)for(let o=0;o<8;o++)if(!this.isEmpty(l,o)){const n=this.getPiece(l,o);if(n.colour!==e&&n.name!==u.KING){const e=n.getAttack(this);t.push.apply(t,e)}}return[t,[]]};movePiece=(e,t)=>{const l=this.board[t.oldCell.row][t.oldCell.col].movePiece(t,this);return this.moves.push(t),l};undoMove=()=>{if(this.moves.length>0){const e=this.moves.pop(),t=e.oldCell.row,l=e.oldCell.col,o=this.board[e.newCell.row][e.newCell.col];return this.board[t][l]=o,o.moves.pop(),o.cell.row=t,o.cell.col=l,e.isEnPassant?(this.board[e.ate.cell.row][e.ate.cell.col]=e.ate,this.board[e.newCell.row][e.newCell.col]=null,!0):(e.isPromotion?this.board[t][l]=new C(o.colour,o.cell,o.moves):e.castle.isCastle&&(this.board[e.castle.rook.oldCell.row][e.castle.rook.oldCell.col]=e.castle.rook.piece,e.castle.rook.piece.cell.row=e.castle.rook.oldCell.row,e.castle.rook.piece.cell.col=e.castle.rook.oldCell.col,this.board[e.castle.rook.newCell.row][e.castle.rook.newCell.col]=null),this.board[e.newCell.row][e.newCell.col]=e.ate,!0)}return!1};kingHasMoved=e=>{for(const t of this.moves)if(t.piece.name===u.KING&&t.piece.colour===e)return!0;return!1};rookHasMoved=(e,t)=>{const l=e===u.BLACK?0:7,o=t===f.KING_SIDE?7:0;if(null===this.getPiece(l,o)||this.getPiece(l,o).name!==u.ROOK)return!0;for(const n of this.moves)if(n.piece.name===u.ROOK&&n.piece.colour===e&&n.oldCell.row===l&&n.oldCell.col===o)return!0;return!1};castlingSquaresIsEmpty=(e,t)=>{const l=e===u.BLACK?0:7,o=t===f.KING_SIDE?[5,6]:[1,2,3];for(const n of o)if(!this.isEmpty(l,n))return!1;return!0};castlingSquaresUnderAttack=(e,t,l)=>{const o=e===u.BLACK?0:7,n=t===f.KING_SIDE?[4,5,6]:[1,2,3,4];for(const s of n)for(const e of l)if(e.newCell.row===o&&e.newCell.col===s)return!0;return!1};canCastle=(e,t,l)=>this.castlingSquaresIsEmpty(e,t)&&!this.castlingSquaresUnderAttack(e,t,l)&&!this.rookHasMoved(e,t)&&!this.kingHasMoved(e);promotePiece=e=>{const t=e.cell.row,l=e.cell.col;this.board[t][l]=e};isCheck=(e,t=null)=>{const l=null===t?this.getAttackingSquares(e)[0]:t;for(const o of l){const t=this.getPiece(o.newCell.row,o.newCell.col);if(null!==t&&t.name===u.KING&&t.colour===e)return!0}return!1};willCheck=(e,t)=>(this.movePiece(e,t),this.isCheck(e.colour)?(this.undoMove(),!0):(this.undoMove(),!1));getAllMoves=e=>{let t=[];for(let l=0;l<8;l++)for(let o=0;o<8;o++){null!==this.board[l][o]&&this.getPiece(l,o).colour===e&&(t=t.concat(this.getPiece(l,o).getMoves(this)))}return t};isRepeatPosition=e=>{const t=e;if(this.moves.length>=t){const e=this.moves.slice(-t);let l=e[0],o=e[1];for(let n=2;n<t;n+=4){const t=e[n],s=e[n+1];if(t.newCell.row!==l.oldCell.row||t.newCell.col!==l.oldCell.col||l.piece!==t.piece)return!1;if(s.newCell.row!==o.oldCell.row||s.newCell.col!==o.oldCell.col||o.piece!==s.piece)return!1}return!0}return!1};isGameOver=e=>{const t=this.getAllMoves(e),l=e===u.BLACK?"White":"Black";return t.length<=0?{isGameOver:!0,message:l+" wins by checkmate",allMoves:t}:{isGameOver:!1,message:"",allMoves:t}};getAllMoves=e=>{let t=[];for(let l=0;l<8;l++)for(let o=0;o<8;o++)if(!this.isEmpty(l,o)&&this.getPiece(l,o).colour===e){const e=this.getPiece(l,o).getMoves(this);t=t.concat(e)}return t};scanSquaresScore=e=>{let t=0,l=0;for(let o=0;o<8;o++)for(let e=0;e<8;e++){const n=this.getPiece(o,e);null!==n&&(n.colour===u.WHITE?l+=n.points:l-=n.points,n.colour===u.WHITE?t+=n.whiteScore[o][e]:t-=n.blackScore[o][e])}return t+l};getScore=e=>{e===u.WHITE?u.BLACK:u.WHITE;return this.scanSquaresScore(e)*e*-1};getBoardString=()=>{const e=[];for(let t=0;t<8;t++){const l=[];for(let e=0;e<8;e++){const o=this.getPiece(t,e);null!==o?l.push(o.getString()):l.push(null)}e.push(l)}return e}}class a{constructor(e,t){this.row=e,this.col=t}}class w{oldCell;newCell;constructor(e,t,l,o=!1,n={isCastle:!1},s=null,r=!1){this.oldCell=e,this.newCell=t,this.piece=l,this.isEnPassant=o,this.castle=n,this.ate=s,this.isPromotion=r}getMoveString=()=>({oldCellRow:this.oldCell.row,oldCellCol:this.oldCell.col,newCellRow:this.newCell.row,newCellCol:this.newCell.col,pieceString:this.piece.getString(),isEnPassant:this.isEnPassant,castle:!1===this.castle.isCastle?{isCastle:!1}:{isCastle:!0,rook:{pieceString:this.castle.rook.piece.getString(),oldCellRow:this.castle.rook.oldCell.row,oldCellCol:this.castle.rook.oldCell.col,newCellRow:this.castle.rook.newCell.row,newCellCol:this.castle.rook.newCell.col}},ate:null!==this.ate?this.ate.getString():null,isPromotion:this.isPromotion});static parseMove=(e,t)=>{const l=new w(new a(t.oldCellRow,t.oldCellCol),new a(t.newCellRow,t.newCellCol),u.parsePieceString(t.pieceString),t.isEnPassant,{isCastle:!1},null,t.isPromotion);if(t.castle.isCastle){const o=t.castle.rook;l.castle.isCastle=!0,l.castle.rook=new w(new a(o.oldCellRow,o.oldCellCol),new a(o.newCellRow,o.newCellCol),e.getPiece(o.oldCellRow,o.oldCellCol))}return l}}class u{static WHITE=-1;static BLACK=1;static ROOK="r";static BISHOP="b";static KNIGHT="n";static KING="k";static QUEEN="q";static PAWN="p";constructor(e,t,l=[]){this.colour=e,this.cell=t,this.moves=l}static parsePieceString=e=>{const t="w"===e.slice(0,1)?u.WHITE:u.BLACK,l=e.slice(1,2);return"b"===l?new h(t,new a(0,0)):"k"===l?new f(t,new a(0,0)):"n"===l?new d(t,new a(0,0)):"p"===l?new C(t,new a(0,0)):"q"===l?new p(t,new a(0,0)):"r"===l?new g(t,new a(0,0)):null}}class h extends u{directions=[[1,1],[-1,-1],[1,-1],[-1,1]];points=330;name=u.BISHOP;whiteScore=[[-20,-10,-10,-10,-10,-10,-10,-20],[-10,0,0,0,0,0,0,-10],[-10,0,5,10,10,5,0,-10],[-10,5,5,10,10,5,5,-10],[-10,0,10,10,10,10,0,-10],[-10,10,10,10,10,10,10,-10],[-10,5,0,0,0,0,5,-10],[-20,-10,-10,-10,-10,-10,-10,-20]];blackScore=[[-20,-10,-10,-10,-10,-10,-10,-20],[-10,5,0,0,0,0,5,-10],[-10,10,10,10,10,10,10,-10],[-10,0,10,10,10,10,0,-10],[-10,5,5,10,10,5,5,-10],[-10,0,5,10,10,5,0,-10],[-10,0,0,0,0,0,0,-10],[-20,-10,-10,-10,-10,-10,-10,-20]];constructor(e,t,l){super(e,t,l)}getMoves=e=>{const t=[];for(const l of this.directions){const o=this.cell.row,n=this.cell.col,s=l[0],r=l[1];let c=s+o,i=r+n;for(;e.canMove(c,i)||e.canEat(c,i,this.colour);){const l=new w(this.cell,new a(c,i),this);if(e.willCheck(this,l)||t.push(l),e.canEat(c,i,this.colour))break;c+=s,i+=r}}return t};getAttack=e=>{const t=[];for(const l of this.directions){const o=this.cell.row,n=this.cell.col,s=l[0],r=l[1];let c=s+o,i=r+n;for(;(e.canMove(c,i)||e.canEatDefend(c,i))&&(t.push(new w(this.cell,new a(c,i),this)),!e.canEatDefend(c,i));)c+=s,i+=r}return t};movePiece=(e,t)=>{const l=t.getBoard(),o=e.newCell.row,n=e.newCell.col,s=l[o][n];return null!==s&&(e.ate=s),l[o][n]=this,l[e.oldCell.row][e.oldCell.col]=null,this.cell=new a(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===u.WHITE?"w":"b")+"b"}class f extends u{directions=[[1,1],[-1,-1],[1,-1],[-1,1],[0,1],[1,0],[0,-1],[-1,0]];static KING_SIDE="king";static QUEEN_SIDE="queen";name=u.KING;points=2e4;whiteScore=[[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-20,-30,-30,-40,-40,-30,-30,-20],[-10,-20,-20,-20,-20,-20,-20,-10],[20,20,0,0,0,0,20,20],[20,30,10,0,0,10,30,20]];blackScore=[[20,30,10,0,0,10,30,20],[20,20,0,0,0,0,20,20],[-10,-20,-20,-20,-20,-20,-20,-10],[-20,-30,-30,-40,-40,-30,-30,-20],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30]];whiteScoreEnd=[[-50,-40,-30,-20,-20,-30,-40,-50],[-30,-20,-10,0,0,-10,-20,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-30,0,0,0,0,-30,-30],[-50,-30,-30,-30,-30,-30,-30,-50]];blackScoreEnd=[[-50,-30,-30,-30,-30,-30,-30,-50],[-30,-30,0,0,0,0,-30,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-20,-10,0,0,-10,-20,-30],[-50,-40,-30,-20,-20,-30,-40,-50]];constructor(e,t,l){super(e,t,l)}getMoves=e=>{const t=[],l=e.getAttackingSquares(this.colour)[0];for(const n of this.directions){const l=n[0],o=n[1],s=l+this.cell.row,r=o+this.cell.col;if((e.canEat(s,r,this.colour)||e.canMove(s,r))&&e.canKingMove(s,r,this.colour)){const l=new w(this.cell,new a(s,r),this);e.willCheck(this,l)||t.push(l)}}const o=t.filter((e=>{for(const t of l)if(e.newCell.row===t.newCell.row&&e.newCell.col===t.newCell.col)return!1;return!0}));if(e.canCastle(this.colour,f.KING_SIDE,l)){const t=this.colour===u.BLACK?0:7,l=6;o.push(new w(this.cell,new a(t,l),this,!1,{isCastle:!0,rook:new w(new a(t,7),new a(t,5),e.getPiece(t,7))}))}if(e.canCastle(this.colour,f.QUEEN_SIDE,l)){const t=this.colour===u.BLACK?0:7,l=2;o.push(new w(this.cell,new a(t,l),this,!1,{isCastle:!0,rook:new w(new a(t,0),new a(t,3),e.getPiece(t,0))}))}return o};getAttack=e=>this.getMoves(e);movePiece=(e,t)=>{const l=t.getBoard(),o=e.newCell.row,n=e.newCell.col;e.castle.isCastle&&(l[e.castle.rook.newCell.row][e.castle.rook.newCell.col]=e.castle.rook.piece,l[e.castle.rook.oldCell.row][e.castle.rook.oldCell.col]=null,e.castle.rook.piece.cell.row=e.castle.rook.newCell.row,e.castle.rook.piece.cell.col=e.castle.rook.newCell.col);const s=l[o][n];return null!==s&&(e.ate=s),l[o][n]=this,l[e.oldCell.row][e.oldCell.col]=null,this.cell=new a(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===u.WHITE?"w":"b")+"k"}class d extends u{directions=[[1,2],[1,-2],[2,1],[2,-1],[-1,2],[-1,-2],[-2,1],[-2,-1]];points=320;name=u.KNIGHT;whiteScore=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,0,0,0,-20,-40],[-30,0,10,15,15,10,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,10,15,15,10,5,-30],[-40,-20,0,5,5,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]];blackScore=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,5,5,0,-20,-40],[-30,5,10,15,15,10,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,10,15,15,10,0,-30],[-40,-20,0,0,0,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]];constructor(e,t,l){super(e,t,l)}getMoves=e=>{const t=[];for(const l of this.directions){const o=l[0],n=l[1],s=o+this.cell.row,r=n+this.cell.col;if(e.canEat(s,r,this.colour)||e.canMove(s,r)){const l=new w(this.cell,new a(s,r),this);e.willCheck(this,l)||t.push(l)}}return t};getAttack=e=>{const t=[];for(const l of this.directions){const o=l[0],n=l[1],s=o+this.cell.row,r=n+this.cell.col;(e.canEatDefend(s,r)||e.canMove(s,r))&&t.push(new w(this.cell,new a(s,r),this))}return t};movePiece=(e,t)=>{const l=t.getBoard(),o=e.newCell.row,n=e.newCell.col,s=l[o][n];return null!==s&&(e.ate=s),l[o][n]=this,l[e.oldCell.row][e.oldCell.col]=null,this.cell=new a(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===u.WHITE?"w":"b")+"n"}class C extends u{points=100;name=u.PAWN;whiteScore=[[0,0,0,0,0,0,0,0],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]];whiteScoreEnd=[[100,100,100,100,100,100,100,100],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]];blackScore=[[0,0,0,0,0,0,0,0],[5,10,10,-40,-40,10,10,5],[5,10,20,0,0,-10,-5,5],[0,0,0,20,20,0,0,0],[5,5,10,25,25,10,5,5],[10,10,20,30,30,20,10,10],[50,50,50,50,50,50,50,50],[0,0,0,0,0,0,0,0]];blackScoreEnd=[[0,0,0,0,0,0,0,0],[5,10,10,-40,-40,10,10,5],[5,10,20,0,0,-10,-5,5],[0,0,0,20,20,0,0,0],[5,5,10,25,25,10,5,5],[10,10,20,30,30,20,10,10],[50,50,50,50,50,50,50,50],[100,100,100,100,100,100,100,100]];constructor(e,t,l){super(e,t,l)}getMoves=e=>{const t=[];let l=this.cell.row+1*this.colour,o=this.cell.col;if(e.canMove(l,o)){const n=new w(this.cell,new a(l,o),this,void 0,void 0,void 0,0===l||7===l);if(e.willCheck(this,n)||t.push(n),l=this.cell.row+2*this.colour,e.canMove(l,o)&&this.moves.length<=0)if(this.colour===u.BLACK&&1===this.cell.row){const n=new w(this.cell,new a(l,o),this);e.willCheck(this,n)||t.push(n)}else if(this.colour===u.WHITE&&6===this.cell.row){const n=new w(this.cell,new a(l,o),this);e.willCheck(this,n)||t.push(n)}}if(l=this.cell.row+1*this.colour,o=this.cell.col+1,e.canEat(l,o,this.colour)){const n=new w(this.cell,new a(l,o),this,void 0,void 0,e.getPiece(l,o),0===l||7===l);e.willCheck(this,n)||t.push(n)}if(e.canMove(l,o)&&e.moves.length>0){const n=e.moves.slice(-1)[0];if(n.piece.name===u.PAWN&&n.newCell.row===this.cell.row&&n.newCell.col===this.cell.col+1&&2===Math.abs(n.newCell.row-n.oldCell.row)){const n=new w(this.cell,new a(l,o),this,!0);e.willCheck(this,n)||t.push(n)}}if(l=this.cell.row+1*this.colour,o=this.cell.col-1,e.canEat(l,o,this.colour)){const n=new w(this.cell,new a(l,o),this,void 0,void 0,e.getPiece(l,o),0===l||7===l);e.willCheck(this,n)||t.push(n)}if(e.canMove(l,o)&&e.moves.length>0){const n=e.moves.slice(-1)[0];if(n.piece.name===u.PAWN&&n.newCell.row===this.cell.row&&n.newCell.col===this.cell.col-1&&2===Math.abs(n.newCell.row-n.oldCell.row)){const n=new w(this.cell,new a(l,o),this,!0);e.willCheck(this,n)||t.push(n)}}return t};getAttack=e=>{const t=[];let l=this.cell.row+1*this.colour,o=this.cell.col+1;return(e.canMove(l,o)||e.canEatDefend(l,o))&&t.push(new w(this.cell,new a(l,o),this)),l=this.cell.row+1*this.colour,o=this.cell.col-1,(e.canMove(l,o)||e.canEatDefend(l,o))&&t.push(new w(this.cell,new a(l,o),this)),t};movePiece=(e,t)=>{const l=t.getBoard(),o=e.newCell.row,n=e.newCell.col;if(e.isEnPassant){const o=t.moves.slice(-1)[0],n=l[o.newCell.row][o.newCell.col];null!==n&&(e.ate=n),l[o.newCell.row][o.newCell.col]=null}const s=l[o][n];return null!==s&&(e.ate=s),l[o][n]=this,l[e.oldCell.row][e.oldCell.col]=null,this.cell=new a(o,n),e.isPromotion?(l[o][n]=new p(this.colour,this.cell),{promotion:!0,row:o,col:n}):(this.moves.push(e),{row:o,col:n})};getString=()=>(this.colour===u.WHITE?"w":"b")+"p"}class p extends u{directions=[[1,1],[-1,-1],[1,-1],[-1,1],[0,1],[1,0],[0,-1],[-1,0]];points=900;name=u.QUEEN;whiteScore=[[-20,-10,-10,-5,-5,-10,-10,-20],[-10,0,0,0,0,0,0,-10],[-10,0,5,5,5,5,0,-10],[-5,0,5,5,5,5,0,-5],[0,0,5,5,5,5,0,-5],[-10,5,5,5,5,5,0,-10],[-10,0,5,0,0,0,0,-10],[-20,-10,-10,-5,-5,-10,-10,-20]];blackScore=[[-20,-10,-10,-5,-5,-10,-10,-20],[-10,0,5,0,0,0,0,-10],[-10,5,5,5,5,5,0,-10],[0,0,5,5,5,5,0,-5],[-5,0,5,5,5,5,0,-5],[-10,0,5,5,5,5,0,-10],[-10,0,0,0,0,0,0,-10],[-20,-10,-10,-5,-5,-10,-10,-20]];constructor(e,t,l){super(e,t,l)}getMoves=e=>{const t=[];for(const l of this.directions){const o=this.cell.row,n=this.cell.col,s=l[0],r=l[1];let c=s+o,i=r+n;for(;e.canMove(c,i)||e.canEat(c,i,this.colour);){const l=new w(this.cell,new a(c,i),this);if(e.willCheck(this,l)||t.push(l),e.canEat(c,i,this.colour))break;c+=s,i+=r}}return t};getAttack=e=>{const t=[];for(const l of this.directions){const o=this.cell.row,n=this.cell.col,s=l[0],r=l[1];let c=s+o,i=r+n;for(;(e.canMove(c,i)||e.canEatDefend(c,i))&&(t.push(new w(this.cell,new a(c,i),this)),!e.canEatDefend(c,i));)c+=s,i+=r}return t};movePiece=(e,t)=>{const l=t.getBoard(),o=e.newCell.row,n=e.newCell.col,s=l[o][n];return null!==s&&(e.ate=s),l[o][n]=this,l[e.oldCell.row][e.oldCell.col]=null,this.cell=new a(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===u.WHITE?"w":"b")+"q"}class g extends u{directions=[[0,1],[1,0],[0,-1],[-1,0]];points=500;name=u.ROOK;whiteScore=[[0,0,0,0,0,0,0,0],[5,10,10,10,10,10,10,5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[0,0,0,5,5,0,0,0]];blackScore=[[0,0,4,5,5,10,0,0],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[5,10,10,10,10,10,10,5],[0,0,0,0,0,0,0,0]];constructor(e,t,l){super(e,t,l)}getMoves=e=>{const t=[];for(const l of this.directions){const o=this.cell.row,n=this.cell.col,s=l[0],r=l[1];let c=s+o,i=r+n;for(;e.canMove(c,i)||e.canEat(c,i,this.colour);){const l=new w(this.cell,new a(c,i),this);if(e.willCheck(this,l)||t.push(l),e.canEat(c,i,this.colour))break;c+=s,i+=r}}return t};getAttack=e=>{const t=[];for(const l of this.directions){const o=this.cell.row,n=this.cell.col,s=l[0],r=l[1];let c=s+o,i=r+n;for(;e.canMove(c,i)||e.canEatDefend(c,i);){const l=new w(this.cell,new a(c,i),this);if(t.push(l),e.canEatDefend(c,i))break;c+=s,i+=r}}return t};movePiece=(e,t)=>{const l=t.getBoard(),o=e.newCell.row,n=e.newCell.col,s=l[o][n];return null!==s&&(e.ate=s),l[o][n]=this,l[e.oldCell.row][e.oldCell.col]=null,this.cell=new a(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===u.WHITE?"w":"b")+"r"}try{const l=e.data;if(l.newGame)b=0,S=new Map;else if(l.undo)b--,S=new Map;else{const e=l[0],o=l[1],n=l[2],s=l[3];if(0===b){if(s===u.WHITE){const e=[new w(new a(6,3),new a(4,3),new C(u.WHITE,new a(6,3))),new w(new a(6,4),new a(4,4),new C(u.WHITE,new a(6,4)))],t=Math.round(Math.random()*(e.length-1));postMessage(e[t].getMoveString())}else{const l=n.map((e=>w.parseMove(void 0,e)))[0];if(6===l.oldCell.row&&4===l.oldCell.col&&4===l.newCell.row&&4===l.newCell.col){const e=[new w(new a(1,2),new a(3,2),new C(u.BLACK,new a(1,2))),new w(new a(1,4),new a(3,4),new C(u.BLACK,new a(1,4)))],t=Math.round(Math.random()*(e.length-1));postMessage(e[t].getMoveString())}else{const l=t(e,o,n,s);postMessage(l.getMoveString())}}b++}else{const l=t(e,o,n,s);postMessage(l.getMoveString())}}}catch(v){postMessage({isError:!0,message:"Error: "+v})}}))}();
//# sourceMappingURL=worker.worker.7eb23eef.worker.js.map