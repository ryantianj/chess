!function(){let e=0,l=!1;self.addEventListener("message",(async t=>{const o=(e,t,o,n)=>{const s=new r;s.setBoardString(e),s.moves=o.map((e=>h.parseMove(s,e))),l=s.isEndGame(),l&&(console.log("endgame"),s.setEndGame()),s.updatePieceValues();const i=new Map,w=c(s,t,-Number.MAX_VALUE,Number.MAX_VALUE,!0,n,n,t,i);return console.log("Score",w[1]),w[0]},n=(e,l)=>e.getScore(l),s=e=>e===a.BLACK?a.WHITE:a.BLACK,c=(e,l,t,o,r,w,h,a,u)=>{if(0===l){let l;const t=e.getBoardHash()+w.toString();return u.has(t)?l=u.get(t):(l=n(e,w),u.set(t,l)),[null,l]}const C=e.isGameOver(h);if(C.isGameOver&&h===w)return[null,-Number.MAX_VALUE];if(C.isGameOver&&h!==w)return[null,Number.MAX_VALUE];const d=C.allMoves;d.sort(i);const f=Math.floor(Math.random()*(d.length-1));let g=d.length>0?d[f]:null;if(r){let n=-Number.MAX_VALUE;for(const i of d){e.movePiece(i.piece,i);const r=c(e,l-1,t,o,!1,w,s(h),a,u)[1];if(e.undoMove(),r>n&&(n=r,g=i),o<=(t=Math.max(t,r)))break}return[g,n]}{let n=Number.MAX_VALUE;for(const i of d){e.movePiece(i.piece,i);const r=c(e,l-1,t,o,!0,w,s(h),a,u)[1];if(e.undoMove(),r<n&&(n=r,g=i),(o=Math.min(o,r))<=t)break}return[g,n]}},i=(e,l)=>{if(null!==e.ate&&null!==l.ate){return e.piece.points-e.ate.points<l.piece.points-l.ate.points?-1:1}if(null!==e.ate)return-1;if(null!==l.ate)return 1;return(e.piece.colour===a.WHITE?e.piece.whiteScore[e.newCell.row][e.newCell.col]:e.piece.blackScore[e.newCell.row][e.newCell.col])<(l.piece.colour===a.WHITE?l.piece.whiteScore[l.newCell.row][l.newCell.col]:l.piece.blackScore[l.newCell.row][l.newCell.col])?1:-1};class r{board;constructor(){this.board=this.newBoard(),this.moves=[]}newBoard=()=>[[new p(a.BLACK,new w(0,0)),new d(a.BLACK,new w(0,1)),new u(a.BLACK,new w(0,2)),new g(a.BLACK,new w(0,3)),new C(a.BLACK,new w(0,4)),new u(a.BLACK,new w(0,5)),new d(a.BLACK,new w(0,6)),new p(a.BLACK,new w(0,7))],[new f(a.BLACK,new w(1,0)),new f(a.BLACK,new w(1,1)),new f(a.BLACK,new w(1,2)),new f(a.BLACK,new w(1,3)),new f(a.BLACK,new w(1,4)),new f(a.BLACK,new w(1,5)),new f(a.BLACK,new w(1,6)),new f(a.BLACK,new w(1,7))],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[new f(a.WHITE,new w(6,0)),new f(a.WHITE,new w(6,1)),new f(a.WHITE,new w(6,2)),new f(a.WHITE,new w(6,3)),new f(a.WHITE,new w(6,4)),new f(a.WHITE,new w(6,5)),new f(a.WHITE,new w(6,6)),new f(a.WHITE,new w(6,7))],[new p(a.WHITE,new w(7,0)),new d(a.WHITE,new w(7,1)),new u(a.WHITE,new w(7,2)),new g(a.WHITE,new w(7,3)),new C(a.WHITE,new w(7,4)),new u(a.WHITE,new w(7,5)),new d(a.WHITE,new w(7,6)),new p(a.WHITE,new w(7,7))]];setEndGame=()=>{for(let e=0;e<8;e++)for(let l=0;l<8;l++){const t=this.getPiece(e,l);null!==t&&void 0!==t.whiteScoreEnd&&(t.colour===a.WHITE?t.whiteScore=t.whiteScoreEnd:t.blackScore=t.blackScoreEnd)}};updatePieceValues=()=>{let e=0,l=0;for(let t=0;t<8;t++)for(let o=0;o<8;o++){const n=this.getPiece(t,o);null!==n&&n instanceof f&&(n.colour===a.WHITE?e++:l++)}for(let t=0;t<8;t++)for(let o=0;o<8;o++){const n=this.getPiece(t,o);if(null!==n&&(n instanceof d&&(n.points-=3*(16-e-l)),n instanceof u&&(n.points+=3*(16-e-l)),n instanceof p&&(n.points+=3*(16-e-l)),n instanceof f)){let e=!0;if(o+1<8)for(let t=0;t<8;t++)this.getPiece(t,o+1)instanceof f&&(e=!1);if(o-1>=0)for(let t=0;t<8;t++)this.getPiece(t,o-1)instanceof f&&(e=!1);e&&(n.points+=30);let l=!1;for(let o=0;o<8;o++)n instanceof f&&o!==t&&(l=!0);l&&(n.points-=10)}}};isEndGame=()=>{let e=0,l=0,t=0,o=0;for(let n=0;n<8;n++)for(let s=0;s<8;s++){const c=this.getPiece(n,s);c instanceof g&&(c.colour===a.WHITE?t++:o++),(c instanceof p||c instanceof u||c instanceof d)&&(c.colour===a.WHITE?e++:l++)}return t<=1&&e<=0||o<=1&&l<=0||e<=2&&t<=0||l<=2&&o<=0};setBoardString=e=>{const l=[];for(let t=0;t<8;t++){const o=[];for(let l=0;l<8;l++){const n=e[t][l];if(null===n)o.push(null);else{const e="w"===n.slice(0,1)?a.WHITE:a.BLACK,s=n.slice(1,2);"b"===s?o.push(new u(e,new w(t,l))):"k"===s?o.push(new C(e,new w(t,l))):"n"===s?o.push(new d(e,new w(t,l))):"p"===s?o.push(new f(e,new w(t,l))):"q"===s?o.push(new g(e,new w(t,l))):"r"===s?o.push(new p(e,new w(t,l))):o.push(null)}}l.push(o)}this.board=l};getBoardHash=()=>{let e="";for(let l=0;l<8;l++)for(let t=0;t<8;t++)this.isEmpty(l,t)?e+=" ":e+=this.getPiece(l,t).getString();return e};clonePiece=e=>e instanceof f?new f(e.colour,new w(e.cell.row,e.cell.col)):e instanceof u?new u(e.colour,new w(e.cell.row,e.cell.col)):e instanceof C?new C(e.colour,new w(e.cell.row,e.cell.col)):e instanceof d?new d(e.colour,new w(e.cell.row,e.cell.col)):e instanceof g?new g(e.colour,new w(e.cell.row,e.cell.col)):e instanceof p?new p(e.colour,new w(e.cell.row,e.cell.col)):null;getBoard=()=>this.board;getPiece=(e,l)=>this.board[e][l];isEmpty=(e,l)=>!this.isOutSide(e,l)&&null===this.board[e][l];isUnderCheck=e=>!1;isOutSide=(e,l)=>e<0||l<0||e>7||l>7;canEat=(e,l,t)=>!this.isOutSide(e,l)&&!this.isEmpty(e,l)&&this.getPiece(e,l).colour!==t;canEatDefend=(e,l)=>!this.isOutSide(e,l)&&!this.isEmpty(e,l);canMove=(e,l)=>!this.isOutSide(e,l)&&this.isEmpty(e,l);canKingMove=(e,l,t)=>{const o=[[1,1],[-1,-1],[1,-1],[-1,1],[0,1],[1,0],[0,-1],[-1,0]];for(const n of o){const o=e+n[0],s=l+n[1];if(!this.isOutSide(o,s)&&!this.isEmpty(o,s)&&this.getPiece(o,s).name===a.KING&&this.getPiece(o,s).colour!==t)return!1}return!0};getAttackingSquares=e=>{const l=[];for(let t=0;t<8;t++)for(let o=0;o<8;o++)if(!this.isEmpty(t,o)){const n=this.getPiece(t,o);if(n.colour!==e&&n.name!==a.KING){const e=n.getAttack(this);l.push.apply(l,e)}}return[l,[]]};movePiece=(e,l)=>{const t=this.board[l.oldCell.row][l.oldCell.col].movePiece(l,this);return this.moves.push(l),t};undoMove=()=>{if(this.moves.length>0){const e=this.moves.pop(),l=e.oldCell.row,t=e.oldCell.col,o=this.board[e.newCell.row][e.newCell.col];return this.board[l][t]=o,o.moves.pop(),o.cell.row=l,o.cell.col=t,e.isEnPassant?(this.board[e.ate.cell.row][e.ate.cell.col]=e.ate,this.board[e.newCell.row][e.newCell.col]=null,!0):(e.isPromotion?this.board[l][t]=new f(o.colour,o.cell,o.moves):e.castle.isCastle&&(this.board[e.castle.rook.oldCell.row][e.castle.rook.oldCell.col]=e.castle.rook.piece,e.castle.rook.piece.cell.row=e.castle.rook.oldCell.row,e.castle.rook.piece.cell.col=e.castle.rook.oldCell.col,this.board[e.castle.rook.newCell.row][e.castle.rook.newCell.col]=null),this.board[e.newCell.row][e.newCell.col]=e.ate,!0)}return!1};kingHasMoved=e=>{for(const l of this.moves)if(l.piece.name===a.KING&&l.piece.colour===e)return!0;return!1};rookHasMoved=(e,l)=>{const t=e===a.BLACK?0:7,o=l===C.KING_SIDE?7:0;if(null===this.getPiece(t,o)||this.getPiece(t,o).name!==a.ROOK)return!0;for(const n of this.moves)if(n.piece.name===a.ROOK&&n.piece.colour===e&&n.oldCell.row===t&&n.oldCell.col===o)return!0;return!1};castlingSquaresIsEmpty=(e,l)=>{const t=e===a.BLACK?0:7,o=l===C.KING_SIDE?[5,6]:[1,2,3];for(const n of o)if(!this.isEmpty(t,n))return!1;return!0};castlingSquaresUnderAttack=(e,l,t)=>{const o=e===a.BLACK?0:7,n=l===C.KING_SIDE?[4,5,6]:[1,2,3,4];for(const s of n)for(const e of t)if(e.newCell.row===o&&e.newCell.col===s)return!0;return!1};canCastle=(e,l,t)=>this.castlingSquaresIsEmpty(e,l)&&!this.castlingSquaresUnderAttack(e,l,t)&&!this.rookHasMoved(e,l)&&!this.kingHasMoved(e);promotePiece=e=>{const l=e.cell.row,t=e.cell.col;this.board[l][t]=e};isCheck=(e,l=null)=>{const t=null===l?this.getAttackingSquares(e)[0]:l;for(const o of t){const l=this.getPiece(o.newCell.row,o.newCell.col);if(null!==l&&l.name===a.KING&&l.colour===e)return!0}return!1};willCheck=(e,l)=>(this.movePiece(e,l),this.isCheck(e.colour)?(this.undoMove(),!0):(this.undoMove(),!1));getAllMoves=e=>{let l=[];for(let t=0;t<8;t++)for(let o=0;o<8;o++){null!==this.board[t][o]&&this.getPiece(t,o).colour===e&&(l=l.concat(this.getPiece(t,o).getMoves(this)))}return l};isRepeatPosition=e=>{const l=e;if(this.moves.length>=l){const e=this.moves.slice(-l);let t=e[0],o=e[1];for(let n=2;n<l;n+=4){const l=e[n],s=e[n+1];if(l.newCell.row!==t.oldCell.row||l.newCell.col!==t.oldCell.col||t.piece!==l.piece)return!1;if(s.newCell.row!==o.oldCell.row||s.newCell.col!==o.oldCell.col||o.piece!==s.piece)return!1}return!0}return!1};isGameOver=e=>{const l=this.getAllMoves(e),t=e===a.BLACK?"White":"Black";return l.length<=0?{isGameOver:!0,message:t+" wins by checkmate",allMoves:l}:{isGameOver:!1,message:"",allMoves:l}};getAllMoves=e=>{let l=[];for(let t=0;t<8;t++)for(let o=0;o<8;o++)if(!this.isEmpty(t,o)&&this.getPiece(t,o).colour===e){const e=this.getPiece(t,o).getMoves(this);l=l.concat(e)}return l};scanSquaresScore=e=>{let l=0,t=0;for(let o=0;o<8;o++)for(let e=0;e<8;e++){const n=this.getPiece(o,e);null!==n&&(n.colour===a.WHITE?t+=n.points:t-=n.points,n.colour===a.WHITE?l+=n.whiteScore[o][e]:l-=n.blackScore[o][e])}return l+t};getScore=e=>{e===a.WHITE?a.BLACK:a.WHITE;return this.scanSquaresScore(e)*e*-1};getBoardString=()=>{const e=[];for(let l=0;l<8;l++){const t=[];for(let e=0;e<8;e++){const o=this.getPiece(l,e);null!==o?t.push(o.getString()):t.push(null)}e.push(t)}return e}}class w{constructor(e,l){this.row=e,this.col=l}}class h{oldCell;newCell;constructor(e,l,t,o=!1,n={isCastle:!1},s=null,c=!1){this.oldCell=e,this.newCell=l,this.piece=t,this.isEnPassant=o,this.castle=n,this.ate=s,this.isPromotion=c}getMoveString=()=>({oldCellRow:this.oldCell.row,oldCellCol:this.oldCell.col,newCellRow:this.newCell.row,newCellCol:this.newCell.col,pieceString:this.piece.getString(),isEnPassant:this.isEnPassant,castle:!1===this.castle.isCastle?{isCastle:!1}:{isCastle:!0,rook:{pieceString:this.castle.rook.piece.getString(),oldCellRow:this.castle.rook.oldCell.row,oldCellCol:this.castle.rook.oldCell.col,newCellRow:this.castle.rook.newCell.row,newCellCol:this.castle.rook.newCell.col}},ate:null!==this.ate?this.ate.getString():null,isPromotion:this.isPromotion});static parseMove=(e,l)=>{const t=new h(new w(l.oldCellRow,l.oldCellCol),new w(l.newCellRow,l.newCellCol),a.parsePieceString(l.pieceString),l.isEnPassant,{isCastle:!1},null,l.isPromotion);if(l.castle.isCastle){const o=l.castle.rook;t.castle.isCastle=!0,t.castle.rook=new h(new w(o.oldCellRow,o.oldCellCol),new w(o.newCellRow,o.newCellCol),e.getPiece(o.oldCellRow,o.oldCellCol))}return t}}class a{static WHITE=-1;static BLACK=1;static ROOK="r";static BISHOP="b";static KNIGHT="n";static KING="k";static QUEEN="q";static PAWN="p";constructor(e,l,t=[]){this.colour=e,this.cell=l,this.moves=t}static parsePieceString=e=>{const l="w"===e.slice(0,1)?a.WHITE:a.BLACK,t=e.slice(1,2);return"b"===t?new u(l,new w(0,0)):"k"===t?new C(l,new w(0,0)):"n"===t?new d(l,new w(0,0)):"p"===t?new f(l,new w(0,0)):"q"===t?new g(l,new w(0,0)):"r"===t?new p(l,new w(0,0)):null}}class u extends a{directions=[[1,1],[-1,-1],[1,-1],[-1,1]];points=330;name=a.BISHOP;whiteScore=[[-20,-10,-10,-10,-10,-10,-10,-20],[-10,0,0,0,0,0,0,-10],[-10,0,5,10,10,5,0,-10],[-10,5,5,10,10,5,5,-10],[-10,0,10,10,10,10,0,-10],[-10,10,10,10,10,10,10,-10],[-10,5,0,0,0,0,5,-10],[-20,-10,-10,-10,-10,-10,-10,-20]];blackScore=[[-20,-10,-10,-10,-10,-10,-10,-20],[-10,5,0,0,0,0,5,-10],[-10,10,10,10,10,10,10,-10],[-10,0,10,10,10,10,0,-10],[-10,5,5,10,10,5,5,-10],[-10,0,5,10,10,5,0,-10],[-10,0,0,0,0,0,0,-10],[-20,-10,-10,-10,-10,-10,-10,-20]];constructor(e,l,t){super(e,l,t)}getMoves=e=>{const l=[];for(const t of this.directions){const o=this.cell.row,n=this.cell.col,s=t[0],c=t[1];let i=s+o,r=c+n;for(;e.canMove(i,r)||e.canEat(i,r,this.colour);){const t=new h(this.cell,new w(i,r),this);if(e.willCheck(this,t)||l.push(t),e.canEat(i,r,this.colour))break;i+=s,r+=c}}return l};getAttack=e=>{const l=[];for(const t of this.directions){const o=this.cell.row,n=this.cell.col,s=t[0],c=t[1];let i=s+o,r=c+n;for(;(e.canMove(i,r)||e.canEatDefend(i,r))&&(l.push(new h(this.cell,new w(i,r),this)),!e.canEatDefend(i,r));)i+=s,r+=c}return l};movePiece=(e,l)=>{const t=l.getBoard(),o=e.newCell.row,n=e.newCell.col,s=t[o][n];return null!==s&&(e.ate=s),t[o][n]=this,t[e.oldCell.row][e.oldCell.col]=null,this.cell=new w(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===a.WHITE?"w":"b")+"b"}class C extends a{directions=[[1,1],[-1,-1],[1,-1],[-1,1],[0,1],[1,0],[0,-1],[-1,0]];static KING_SIDE="king";static QUEEN_SIDE="queen";name=a.KING;points=2e4;whiteScore=[[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-20,-30,-30,-40,-40,-30,-30,-20],[-10,-20,-20,-20,-20,-20,-20,-10],[20,20,0,0,0,0,20,20],[20,30,10,0,0,10,30,20]];blackScore=[[20,30,10,0,0,10,30,20],[20,20,0,0,0,0,20,20],[-10,-20,-20,-20,-20,-20,-20,-10],[-20,-30,-30,-40,-40,-30,-30,-20],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30]];whiteScoreEnd=[[-50,-40,-30,-20,-20,-30,-40,-50],[-30,-20,-10,0,0,-10,-20,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-30,0,0,0,0,-30,-30],[-50,-30,-30,-30,-30,-30,-30,-50]];blackScoreEnd=[[-50,-30,-30,-30,-30,-30,-30,-50],[-30,-30,0,0,0,0,-30,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,30,40,40,30,-10,-30],[-30,-10,20,30,30,20,-10,-30],[-30,-20,-10,0,0,-10,-20,-30],[-50,-40,-30,-20,-20,-30,-40,-50]];constructor(e,l,t){super(e,l,t)}getMoves=e=>{const l=[],t=e.getAttackingSquares(this.colour)[0];for(const n of this.directions){const t=n[0],o=n[1],s=t+this.cell.row,c=o+this.cell.col;if((e.canEat(s,c,this.colour)||e.canMove(s,c))&&e.canKingMove(s,c,this.colour)){const t=new h(this.cell,new w(s,c),this);e.willCheck(this,t)||l.push(t)}}const o=l.filter((e=>{for(const l of t)if(e.newCell.row===l.newCell.row&&e.newCell.col===l.newCell.col)return!1;return!0}));if(e.canCastle(this.colour,C.KING_SIDE,t)){const l=this.colour===a.BLACK?0:7,t=6;o.push(new h(this.cell,new w(l,t),this,!1,{isCastle:!0,rook:new h(new w(l,7),new w(l,5),e.getPiece(l,7))}))}if(e.canCastle(this.colour,C.QUEEN_SIDE,t)){const l=this.colour===a.BLACK?0:7,t=2;o.push(new h(this.cell,new w(l,t),this,!1,{isCastle:!0,rook:new h(new w(l,0),new w(l,3),e.getPiece(l,0))}))}return o};getAttack=e=>this.getMoves(e);movePiece=(e,l)=>{const t=l.getBoard(),o=e.newCell.row,n=e.newCell.col;e.castle.isCastle&&(t[e.castle.rook.newCell.row][e.castle.rook.newCell.col]=e.castle.rook.piece,t[e.castle.rook.oldCell.row][e.castle.rook.oldCell.col]=null,e.castle.rook.piece.cell.row=e.castle.rook.newCell.row,e.castle.rook.piece.cell.col=e.castle.rook.newCell.col);const s=t[o][n];return null!==s&&(e.ate=s),t[o][n]=this,t[e.oldCell.row][e.oldCell.col]=null,this.cell=new w(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===a.WHITE?"w":"b")+"k"}class d extends a{directions=[[1,2],[1,-2],[2,1],[2,-1],[-1,2],[-1,-2],[-2,1],[-2,-1]];points=320;name=a.KNIGHT;whiteScore=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,0,0,0,-20,-40],[-30,0,10,15,15,10,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,10,15,15,10,5,-30],[-40,-20,0,5,5,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]];blackScore=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,5,5,0,-20,-40],[-30,5,10,15,15,10,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,10,15,15,10,0,-30],[-40,-20,0,0,0,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]];constructor(e,l,t){super(e,l,t)}getMoves=e=>{const l=[];for(const t of this.directions){const o=t[0],n=t[1],s=o+this.cell.row,c=n+this.cell.col;if(e.canEat(s,c,this.colour)||e.canMove(s,c)){const t=new h(this.cell,new w(s,c),this);e.willCheck(this,t)||l.push(t)}}return l};getAttack=e=>{const l=[];for(const t of this.directions){const o=t[0],n=t[1],s=o+this.cell.row,c=n+this.cell.col;(e.canEatDefend(s,c)||e.canMove(s,c))&&l.push(new h(this.cell,new w(s,c),this))}return l};movePiece=(e,l)=>{const t=l.getBoard(),o=e.newCell.row,n=e.newCell.col,s=t[o][n];return null!==s&&(e.ate=s),t[o][n]=this,t[e.oldCell.row][e.oldCell.col]=null,this.cell=new w(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===a.WHITE?"w":"b")+"n"}class f extends a{points=100;name=a.PAWN;whiteScore=[[0,0,0,0,0,0,0,0],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]];whiteScoreEnd=[[100,100,100,100,100,100,100,100],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]];blackScore=[[0,0,0,0,0,0,0,0],[5,10,10,-40,-40,10,10,5],[5,10,20,0,0,-10,-5,5],[0,0,0,20,20,0,0,0],[5,5,10,25,25,10,5,5],[10,10,20,30,30,20,10,10],[50,50,50,50,50,50,50,50],[0,0,0,0,0,0,0,0]];blackScoreEnd=[[0,0,0,0,0,0,0,0],[5,10,10,-40,-40,10,10,5],[5,10,20,0,0,-10,-5,5],[0,0,0,20,20,0,0,0],[5,5,10,25,25,10,5,5],[10,10,20,30,30,20,10,10],[50,50,50,50,50,50,50,50],[100,100,100,100,100,100,100,100]];constructor(e,l,t){super(e,l,t)}getMoves=e=>{const l=[];let t=this.cell.row+1*this.colour,o=this.cell.col;if(e.canMove(t,o)){const n=new h(this.cell,new w(t,o),this,void 0,void 0,void 0,0===t||7===t);if(e.willCheck(this,n)||l.push(n),t=this.cell.row+2*this.colour,e.canMove(t,o)&&this.moves.length<=0)if(this.colour===a.BLACK&&1===this.cell.row){const n=new h(this.cell,new w(t,o),this);e.willCheck(this,n)||l.push(n)}else if(this.colour===a.WHITE&&6===this.cell.row){const n=new h(this.cell,new w(t,o),this);e.willCheck(this,n)||l.push(n)}}if(t=this.cell.row+1*this.colour,o=this.cell.col+1,e.canEat(t,o,this.colour)){const n=new h(this.cell,new w(t,o),this,void 0,void 0,e.getPiece(t,o),0===t||7===t);e.willCheck(this,n)||l.push(n)}if(e.canMove(t,o)&&e.moves.length>0){const n=e.moves.slice(-1)[0];if(n.piece.name===a.PAWN&&n.newCell.row===this.cell.row&&n.newCell.col===this.cell.col+1&&2===Math.abs(n.newCell.row-n.oldCell.row)){const n=new h(this.cell,new w(t,o),this,!0);e.willCheck(this,n)||l.push(n)}}if(t=this.cell.row+1*this.colour,o=this.cell.col-1,e.canEat(t,o,this.colour)){const n=new h(this.cell,new w(t,o),this,void 0,void 0,e.getPiece(t,o),0===t||7===t);e.willCheck(this,n)||l.push(n)}if(e.canMove(t,o)&&e.moves.length>0){const n=e.moves.slice(-1)[0];if(n.piece.name===a.PAWN&&n.newCell.row===this.cell.row&&n.newCell.col===this.cell.col-1&&2===Math.abs(n.newCell.row-n.oldCell.row)){const n=new h(this.cell,new w(t,o),this,!0);e.willCheck(this,n)||l.push(n)}}return l};getAttack=e=>{const l=[];let t=this.cell.row+1*this.colour,o=this.cell.col+1;return(e.canMove(t,o)||e.canEatDefend(t,o))&&l.push(new h(this.cell,new w(t,o),this)),t=this.cell.row+1*this.colour,o=this.cell.col-1,(e.canMove(t,o)||e.canEatDefend(t,o))&&l.push(new h(this.cell,new w(t,o),this)),l};movePiece=(e,l)=>{const t=l.getBoard(),o=e.newCell.row,n=e.newCell.col;if(e.isEnPassant){const o=l.moves.slice(-1)[0],n=t[o.newCell.row][o.newCell.col];null!==n&&(e.ate=n),t[o.newCell.row][o.newCell.col]=null}const s=t[o][n];return null!==s&&(e.ate=s),t[o][n]=this,t[e.oldCell.row][e.oldCell.col]=null,this.cell=new w(o,n),e.isPromotion?(t[o][n]=new g(this.colour,this.cell),{promotion:!0,row:o,col:n}):(this.moves.push(e),{row:o,col:n})};getString=()=>(this.colour===a.WHITE?"w":"b")+"p"}class g extends a{directions=[[1,1],[-1,-1],[1,-1],[-1,1],[0,1],[1,0],[0,-1],[-1,0]];points=900;name=a.QUEEN;whiteScore=[[-20,-10,-10,-5,-5,-10,-10,-20],[-10,0,0,0,0,0,0,-10],[-10,0,5,5,5,5,0,-10],[-5,0,5,5,5,5,0,-5],[0,0,5,5,5,5,0,-5],[-10,5,5,5,5,5,0,-10],[-10,0,5,0,0,0,0,-10],[-20,-10,-10,-5,-5,-10,-10,-20]];blackScore=[[-20,-10,-10,-5,-5,-10,-10,-20],[-10,0,5,0,0,0,0,-10],[-10,5,5,5,5,5,0,-10],[0,0,5,5,5,5,0,-5],[-5,0,5,5,5,5,0,-5],[-10,0,5,5,5,5,0,-10],[-10,0,0,0,0,0,0,-10],[-20,-10,-10,-5,-5,-10,-10,-20]];constructor(e,l,t){super(e,l,t)}getMoves=e=>{const l=[];for(const t of this.directions){const o=this.cell.row,n=this.cell.col,s=t[0],c=t[1];let i=s+o,r=c+n;for(;e.canMove(i,r)||e.canEat(i,r,this.colour);){const t=new h(this.cell,new w(i,r),this);if(e.willCheck(this,t)||l.push(t),e.canEat(i,r,this.colour))break;i+=s,r+=c}}return l};getAttack=e=>{const l=[];for(const t of this.directions){const o=this.cell.row,n=this.cell.col,s=t[0],c=t[1];let i=s+o,r=c+n;for(;(e.canMove(i,r)||e.canEatDefend(i,r))&&(l.push(new h(this.cell,new w(i,r),this)),!e.canEatDefend(i,r));)i+=s,r+=c}return l};movePiece=(e,l)=>{const t=l.getBoard(),o=e.newCell.row,n=e.newCell.col,s=t[o][n];return null!==s&&(e.ate=s),t[o][n]=this,t[e.oldCell.row][e.oldCell.col]=null,this.cell=new w(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===a.WHITE?"w":"b")+"q"}class p extends a{directions=[[0,1],[1,0],[0,-1],[-1,0]];points=500;name=a.ROOK;whiteScore=[[0,0,0,0,0,0,0,0],[5,10,10,10,10,10,10,5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[0,0,0,5,5,0,0,0]];blackScore=[[0,0,4,5,5,10,0,0],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[5,10,10,10,10,10,10,5],[0,0,0,0,0,0,0,0]];constructor(e,l,t){super(e,l,t)}getMoves=e=>{const l=[];for(const t of this.directions){const o=this.cell.row,n=this.cell.col,s=t[0],c=t[1];let i=s+o,r=c+n;for(;e.canMove(i,r)||e.canEat(i,r,this.colour);){const t=new h(this.cell,new w(i,r),this);if(e.willCheck(this,t)||l.push(t),e.canEat(i,r,this.colour))break;i+=s,r+=c}}return l};getAttack=e=>{const l=[];for(const t of this.directions){const o=this.cell.row,n=this.cell.col,s=t[0],c=t[1];let i=s+o,r=c+n;for(;e.canMove(i,r)||e.canEatDefend(i,r);){const t=new h(this.cell,new w(i,r),this);if(l.push(t),e.canEatDefend(i,r))break;i+=s,r+=c}}return l};movePiece=(e,l)=>{const t=l.getBoard(),o=e.newCell.row,n=e.newCell.col,s=t[o][n];return null!==s&&(e.ate=s),t[o][n]=this,t[e.oldCell.row][e.oldCell.col]=null,this.cell=new w(o,n),this.moves.push(e),{row:o,col:n}};getString=()=>(this.colour===a.WHITE?"w":"b")+"r"}try{const l=t.data,n=l[0],s=l[1],c=l[2],i=l[3];if(e=c.length,0===e){if(i===a.WHITE){const e=[new h(new w(6,3),new w(4,3),new f(a.WHITE,new w(6,3))),new h(new w(6,4),new w(4,4),new f(a.WHITE,new w(6,4)))],l=Math.round(Math.random()*(e.length-1));postMessage(e[l].getMoveString())}}else if(1===e){const e=c.map((e=>h.parseMove(void 0,e)))[0];if(6===e.oldCell.row&&4===e.oldCell.col&&4===e.newCell.row&&4===e.newCell.col){const e=[new h(new w(1,2),new w(3,2),new f(a.BLACK,new w(1,2))),new h(new w(1,4),new w(3,4),new f(a.BLACK,new w(1,4)))],l=Math.round(Math.random()*(e.length-1));postMessage(e[l].getMoveString())}else{const e=o(n,s,c,i);postMessage(e.getMoveString())}}else{const e=o(n,s,c,i);postMessage(e.getMoveString())}}catch(E){postMessage({isError:!0,message:"Error: "+E})}}))}();
//# sourceMappingURL=worker.worker.f455c5e1.worker.js.map